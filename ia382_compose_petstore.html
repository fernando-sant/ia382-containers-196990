<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8">
  <title>IA382 ‚Äì Practical Tutorials | Compose & Kubernetes (Pet Store)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Build and deploy a multi-service app with Docker Compose and Kubernetes. Push images to DockerHub.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:#0e1628; --text:#e6ecf5; --muted:#aab6ce; --accent:#00ade1;
      --card:#18233a; --border:rgba(255,255,255,0.1);
      --ok:#35d399; --warn:#f6c445; --bad:#ff6b6b;
      --radius:14px;
      /* Added shadows */
      --shadow-color: rgba(0, 0, 0, 0.2);
      --shadow-color-hover: rgba(0, 0, 0, 0.3);
    }
    [data-theme="light"]{
      --bg:#f9fbff; --text:#1a1f29; --muted:#5b6b86; --accent:#0077cc;
      --card:#ffffff; --border:rgba(0,0,0,0.1);
      --ok:#00a86b; --warn:#e6b20a; --bad:#d9534f;
      /* Added shadows */
      --shadow-color: rgba(0, 0, 0, 0.07);
      --shadow-color-hover: rgba(0, 0, 0, 0.12);
    }
    html{scroll-behavior:smooth;}
    body{
      margin:0; font-family:'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg); color:var(--text); line-height:1.6; transition:background .3s,color .3s;
      overflow-wrap: break-word; word-break: break-word; white-space: normal;
      padding-top: 60px; /* Space for navbar */
      font-feature-settings: "tnum" on, "lnum" on; /* Better numbers */
    }
    
    /* --- Accessibility Focus --- */
    a:focus-visible, 
    button:focus-visible, 
    [role="button"]:focus-visible {
      outline: 3px solid var(--accent);
      outline-offset: 2px;
      box-shadow: 0 0 0 5px var(--bg); /* Creates a "cutout" effect */
      border-radius: 4px; /* Match outline */
    }
    .toc a:focus-visible {
      box-shadow: none; /* Already has a background */
      border: 2px solid var(--accent);
      outline: none;
    }

    .navbar{position:fixed; inset:0 0 auto 0; height:60px; z-index:100; display:flex; justify-content:space-between; align-items:center; padding:0 20px; background:rgba(10,15,25,.8); backdrop-filter:blur(8px); border-bottom:1px solid var(--border);}
    .navbar span{font-weight:700; letter-spacing:.5px; transition: color 0.2s;}
    .navbar span:hover { color: var(--accent); } /* Added */
    
    /* Scroll Progress Bar */
    .progress-bar { 
      position: absolute; 
      bottom: -1px; 
      left: 0; 
      height: 3px; 
      background: var(--accent); 
      width: 0%; 
      z-index: 101; 
      transition: width 0.05s linear; 
      box-shadow: 0 0 8px var(--accent);
    }
    
    .theme-btn{background:none; border:1px solid var(--border); color:var(--text); border-radius:8px; padding:6px 10px; cursor:pointer; transition: 0.2s;}
    .theme-btn:hover{background:var(--accent); color:#fff; border-color:var(--accent);}
    
header {
      position: relative;
      text-align: center;
      padding: 90px 20px 70px;
      color: white; /* Necess√°rio para o texto ficar branco */
      overflow: hidden;
      background: #0b1220; /* Cor de fallback */
      isolation: isolate; /* Necess√°rio para o z-index */
    }
    header::before {
      content: "";
      position: absolute; inset: 0;
      background:
        linear-gradient(rgba(0,0,0,0.55), rgba(0,0,0,0.8)),
        url('https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=1920&auto-format&fit=crop') center/cover no-repeat;
      z-index: -1;
      transform: scale(1.02);
      filter: saturate(1.05);
    }
    header h1 {
      margin: 0 0 8px 0;
      font-size: 2.8rem;
      font-weight: 700;
      letter-spacing: -0.5px;
    }
    header p {
      margin: 10px auto 0;
      max-width: 820px;
      color: #cfd9e7; /* Cor mais clara para o fundo escuro */
      font-size: 1.1rem;
    }
    
    .wrap{max-width:1120px; margin:36px auto; padding:0 20px 60px; display:grid; grid-template-columns:280px 1fr; gap:24px;}
    
    .toc {
      position: sticky;
      top: 84px;
      align-self: start;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 14px;
      
      /* --- SOLU√á√ÉO --- */
      max-height: calc(100vh - 104px); /* Limita a altura (84px do topo + 20px de margem em baixo) */
      overflow-y: auto; /* Adiciona scroll vertical se for maior que a altura */
    }
    .toc h3{ margin:.2rem 0 .6rem; font-size:13px; text-transform:uppercase; letter-spacing:.12em; color:var(--muted);}
    .toc a{ 
      display:block; padding:.35rem .55rem; border-radius:8px; color:var(--text); text-decoration:none; 
      transition: background 0.2s ease, color 0.2s ease; /* Added transition */
    }
    /* Prominent Active State */
    .toc a.active { 
      background: var(--accent);
      color: #fff;
      font-weight: 600;
      box-shadow: 0 2px 10px rgba(0, 173, 225, 0.3);
    }
    [data-theme="light"] .toc a.active {
      color: #fff;
      box-shadow: 0 2px 10px rgba(0, 119, 204, 0.3);
    }
    .toc a:hover{ background:rgba(255,255,255,.08);}

    main h2{ 
      border-bottom:2px solid var(--accent); padding-bottom:6px; 
      margin-top:48px; /* Increased spacing */
      font-size: 2.0rem; /* Increased size */
    }
    main h3 {
      margin-top: 32px; /* Increased */
      font-size: 1.4rem; /* Increased */
    }
    
    .card, .infobox, .exercise{
      background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:18px 22px; margin:24px 0; /* Increased margin */
      /* Added shadows */
      box-shadow: 0 4px 14px var(--shadow-color);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
    }
    .card:hover, .infobox:hover, .exercise:hover {
      transform: translateY(-4px);
      box-shadow: 0 7px 20px var(--shadow-color-hover);
    }
    
    /* Infobox Icons */
    .infobox {
      padding-left: 52px; /* Make space for icon */
    }
    .infobox::before {
      content: '';
      display: block;
      font-size: 1.5rem;
      font-weight: 700;
      position: absolute;
      left: 20px;
      top: 18px;
    }
    .infobox.good { border-left: 4px solid var(--ok); }
    .infobox.good::before { content: '‚úì'; color: var(--ok); }
    
    .infobox.warn { border-left: 4px solid var(--warn); }
    .infobox.warn::before { content: '‚ö†'; color: var(--warn); }
    
    .infobox.bad { border-left: 4px solid var(--bad); }
    .infobox.bad::before { content: '‚úï'; color: var(--bad); } /* Custom 'bad' icon */

    /* Added for consistency, though not used in this file */
    .infobox.info { border-left: 4px solid var(--accent); }
    .infobox.info::before { content: '‚Ñπ'; color: var(--accent); }
    
    .badge{ font-size:.8rem; padding:2px 8px; border-radius:999px; background:rgba(255,255,255,.08); border:1px solid var(--border); margin-left:8px;}
    
    pre{ 
      background: var(--bg); border-radius: 10px; padding: 14px 16px; overflow-x:auto; 
      border:1px solid var(--border); white-space: pre-wrap; word-break: break-word;
      border-left: 4px solid var(--accent); /* Added */
      box-shadow: 0 2px 8px rgba(0,0,0,0.15); /* Added */
    }
    [data-theme="light"] pre { background: #fdfdfd; }
    pre > code { background: transparent; padding: 0; border-radius: 0; }
    
    code{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, 'Liberation Mono', monospace; background:rgba(255,255,255,.06); padding:2px 4px; border-radius:4px;}
    
    .copy-btn{ 
      position:absolute; right:8px; top:8px; font-size:12px; border:1px solid var(--border); 
      border-radius:8px; padding:4px 8px; background:transparent; color:var(--text); cursor:pointer;
      transition: background 0.2s, transform 0.2s, border-color 0.2s; /* Added */
    }
    .copy-btn:hover{ background:var(--accent); color:#fff; border-color:var(--accent);}
    /* Copy Feedback */
    .copy-btn.copied {
      background: #00d084; 
      color: #fff; 
      border-color: #00d084; 
      transform: scale(1.05);
    }
    /* Container para a logo e o texto */
    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px; /* Espa√ßo entre a logo e o texto */
    }
    
    /* Estilo do Logo: Adequado e Adapt√°vel */
    .logo {
      max-height: 40px; /* Altura m√°xima para caber na navbar de 60px */
      width: auto;       /* Largura autom√°tica para manter propor√ß√£o */
      object-fit: contain; /* Garante que a imagem caiba sem distorcer */
    }
    .pre-wrap{ position:relative; }
    figure{ margin:0; padding:0; }
    figcaption{ text-align:center; color:var(--muted); font-size:.9rem; margin-top:8px; }
    
    .pager{ display:flex; justify-content:space-between; gap:12px; margin-top:36px;}
    .pager a{ 
      flex:1; display:flex; align-items:center; justify-content:center; padding:14px; 
      border:1px solid var(--border); border-radius:12px; text-decoration:none; color:var(--text); background:var(--card);
      transition: border-color 0.2s, transform 0.2s; /* Added */
    }
    .pager a:hover{ border-color:var(--accent); transform: translateY(-2px); }
    .pager small { color:var(--muted); display:block; } /* Added */
    
    footer { /* Added */
      text-align: center;
      color: var(--muted);
      border-top: 1px solid var(--border);
      padding: 30px 0 50px;
      margin-top: 30px;
    }
    
    /* --- Scroll Animation --- */
    @keyframes fadeInSlideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-on-scroll {
      opacity: 0; /* Start hidden */
    }
    .animate-on-scroll.in-view {
      animation: fadeInSlideUp 0.6s ease-out forwards;
    }
    
    /* --- Responsiveness --- */
    @media (max-width: 980px){ 
      .grid { grid-template-columns:1fr;} 
      .toc {
        position: relative; top: 0;
        overflow-x: auto;
        white-space: nowrap;
        padding: 8px;
        
        /* --- CORRE√á√ÉO AQUI --- */
        /* Permite que o scroll vertical (pan-y) funcione na p√°gina, 
           enquanto o scroll horizontal (pan-x) funciona no elemento. */
        touch-action: pan-x pan-y; 
      }
      .toc h3 { display: none; }
      .toc a { display: inline-block; padding: 6px 10px; }
    }
    @media (max-width: 600px) {
      header { padding: 70px 15px 50px; }
      header h1 { font-size: 2.2rem; }
      header p { font-size: 1rem; }
      .wrap { margin: 24px auto; padding: 0 15px 30px; }
      .infobox { padding: 16px 18px 16px 48px; } /* Adjust for icon */
      .infobox::before { left: 15px; top: 16px; }
      .pager { flex-direction: column; }
    }
  </style>
</head>
<body>
  <nav class="navbar" aria-label="Primary">
<div class="logo-container">
        <img src="logo.png" alt="Logo" class="logo">
        
        <span>FEEC/UNICAMP ¬∑ IA382 Practical Tutorials</span>
    </div>
    <button class="theme-btn" id="theme-toggle" aria-label="Toggle theme">üåì Theme</button>
  </nav>

  <header>
    <h1>Compose & Kubernetes ¬∑ Pet Store</h1>
    <p>In this tutorial you‚Äôll learn how to build and deploy a multi-service application with Docker Compose, push images to DockerHub, and deploy with Kubernetes.</p>
  </header>

  <div class="wrap">
    <aside class="toc" aria-label="On this page">
      <h3>On this page</h3>
      <nav id="toc-list"></nav>
    </aside>

    <main id="content">
      <section id="intro">
        <h2>Introduction</h2>
        <ul>
          <li>How to build and deploy a multi-service application with <strong>Docker Compose</strong>.</li>
          <li>How to push an image to <strong>DockerHub</strong>.</li>
          <li>How to deploy a multi-service application with <strong>Kubernetes</strong>.</li>
        </ul>
        <div class="infobox warn">
          <strong>Warning.</strong> This tutorial is adapted from the examples presented in Chapters 14 and 20 of the book <em>G. Schenker, Learn Docker - Fundamentals of Docker 19.x</em> (March 2020).
        </div>
      </section>

      <section id="compose">
        <h2>1 ¬∑ Docker Compose</h2>
        <p>In this section, you‚Äôre going to build and deploy a multi-service application by using Docker Compose.</p>
        <p>Download the archive <a href="./activities_files/pet-store.zip">pet-store</a> and unzip it into a folder. The archive contains all the necessary files to build and run a web application consisting of two services:</p>
        <ul>
          <li><strong>web</strong>: frontend (HTML/JS).</li>
          <li><strong>db</strong>: backend (PostgreSQL database).</li>
        </ul>
        <p>The structure of the application is shown in Figure 1.1. The root directory contains two subdirectories, one for each service.</p>
        <figure class="card">
          <div style="display:flex;gap:12px;justify-content:center;align-items:center;flex-wrap:wrap">
            <div style="padding:12px 16px;border:1px solid var(--border);border-radius:10px;background:rgba(255,255,255,.03)">
              <code>pet-store/</code>
              <ul>
                <li><code>database/</code> (.conf, <code>init-db.sql</code>, <code>Dockerfile</code>)</li>
                <li><code>web/</code> (HTML/JS, <code>package.json</code>, <code>Dockerfile</code>)</li>
                <li><code>docker-compose.yml</code></li>
              </ul>
            </div>
          </div>
          <figcaption>Figure 1.1 ‚Äî Structure of the application</figcaption>
        </figure>

        <div class="infobox good">
          <strong>Good to know.</strong>
          <ul>
            <li>The <code>.conf</code> files under <code>database/</code> contain PostgreSQL configuration parameters.</li>
            <li><code>init-db.sql</code> populates the database with sample data (photos of cats).</li>
            <li><code>web/</code> holds HTML/JS; <code>package.json</code> lists dependencies.</li>
          </ul>
        </div>

        <h3>Database Dockerfile</h3>
        <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>FROM postgres
COPY init-db.sql /docker-entrypoint-initdb.d/
RUN chown postgres:postgres /docker-entrypoint-initdb.d/*.sql
ENV POSTGRES_USER dockeruser
ENV POSTGRES_PASSWORD dockerpass
ENV POSTGRES_DB pets</code></pre></div>
        <p>The Dockerfile builds on image <code>postgres</code> (see official documentation).</p>

        <div class="exercise">
          <h3>Exercise 1.1</h3>
          <p>Consider: <code>COPY init-db.sql /docker-entrypoint-initdb.d/</code></p>
          <ol>
            <li>Where is the directory <code>/docker-entrypoint-initdb.d/</code>?</li>
            <li>Why do we copy <code>init-db.sql</code> there?</li>
          </ol>
        </div>

        <div class="exercise">
          <h3>Exercise 1.2</h3>
          <p>Look at the <code>postgres</code> image docs and explain the meaning of the last three <code>ENV</code> lines in the Dockerfile.</p>
        </div>

        <h3>Web Dockerfile</h3>
        <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>FROM node:9.6-alpine
RUN mkdir /app
WORKDIR /app
COPY package.json /app/
RUN npm install
COPY ./src /app/src
EXPOSE 3000
CMD node src/server.js</code></pre></div>
        <div class="infobox good">
          <strong>Good to know.</strong>
          <ul>
            <li><code>npm install</code> installs dependencies from <code>package.json</code>.</li>
            <li><code>EXPOSE 3000</code> documents the listening port; it does <em>not</em> publish it. Port publishing is configured in <code>docker-compose.yml</code>.</li>
          </ul>
        </div>

        <h3>1.1 ¬∑ Describing the application</h3>
        <p>The root directory contains <code>docker-compose.yml</code> with the declarative configuration:</p>
        <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>version: "3.6"
services:
  web:
    build: web
    image: pet-store-web
    networks:
      - backend
    ports:
      - 5000:3000
  db:
    build: database
    image: pet-store-db
    networks:
      - backend
    volumes:
      - pets-data:/var/lib/postgresql/data

networks:
  backend:

volumes:
  pets-data:</code></pre></div>

        <p>Three main sections:</p>
        <ul>
          <li><strong>services</strong>: defines <code>web</code> and <code>db</code>.</li>
          <li><strong>networks</strong>: defines <code>backend</code>.</li>
          <li><strong>volumes</strong>: defines <code>pets-data</code> attached to <code>/var/lib/postgresql/data</code>.</li>
        </ul>

        <div class="exercise">
          <h3>Exercise 1.3</h3>
          <p>What key informs Compose where to find the Dockerfile of the two services?</p>
        </div>

        <div class="exercise">
          <h3>Exercise 1.4</h3>
          <p>What will the names of the two images be? Which key in <code>docker-compose.yml</code> gives this information?</p>
        </div>

        <h3>1.2 ¬∑ Building the application</h3>
        <ol>
          <li><code>cd</code> into the root directory <code>pet-store</code>.</li>
          <li>Execute:</li>
        </ol>
        <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>docker-compose build</code></pre></div>
        <p>Ignore possible <code>npm</code> warnings. Verify images exist (<em>which Docker command?</em>).</p>

        <h3>1.3 ¬∑ Executing the application</h3>
        <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>docker-compose up</code></pre></div>
        <div class="infobox warn">
          <strong>Warning.</strong> If the chosen port is already in use, pick another one. Avoid ports flagged as unsafe by browsers:
          <small>1, 7, 9, 11, 13, 15, 17, 19, 20, 21, 22, 23, 25, 37, 42, 43, 53, 69, 77, 79, 87, 95, 101, 102, 103, 104, 109, 110, 111, 113, 115, 117, 119, 123, 135, 137, 139, 143, 161, 179, 389, 427, 465, 512, 513, 514, 515, 526, 530, 531, 532, 540, 548, 554, 556, 563, 587, 601, 636, 993, 995, 1719, 1720, 1723, 2049, 3659, 4045, 5060, 5061, 6000, 6566, 6665, 6666, 6667, 6668, 6669, 6697, 10080</small>
        </div>
        <p>Open a new terminal/tab.</p>

        <div class="exercise">
          <h3>Exercise 1.5</h3>
          <p>Verify that the <strong>network</strong> and the <strong>volumes</strong> have been created correctly.</p>
        </div>

        <div class="exercise">
          <h3>Exercise 1.6</h3>
          <p>How many containers should be associated with the application?</p>
          <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>docker-compose ps</code></pre></div>
          <p>This is equivalent to <code>docker container ls</code> but scoped to this app.</p>
        </div>

        <div class="exercise">
          <h3>Exercise 1.7</h3>
          <p>In <code>docker-compose ps</code> output, explain the meaning of <code>0.0.0.0:5000-&gt;3000/tcp</code>.</p>
        </div>

        <div class="exercise">
          <h3>Exercise 1.8</h3>
          <p>Which URL do you type in your browser to access the application?</p>
          <div class="infobox warn"><strong>Reminder.</strong> To see the cats, append <code>/pet</code> to the URL (defined in <code>server.js</code>).</div>
        </div>

        <h3>1.4 ¬∑ Shutting down the application</h3>
        <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>docker-compose down</code></pre></div>

        <div class="exercise">
          <h3>Exercise 1.9</h3>
          <p>Does shutting down remove networks? What about volumes?</p>
        </div>

        <h3>1.5 ¬∑ Scaling a service</h3>
        <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>docker-compose up --scale web=3 -d</code></pre></div>
        <div class="exercise">
          <h3>Exercise 1.10</h3>
          <ol>
            <li>Why does the previous command fail initially?</li>
            <li>What fix would you propose in <code>docker-compose.yml</code>?</li>
            <li>After fixing, relaunch and verify three web instances:</li>
          </ol>
          <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>docker-compose ps</code></pre></div>
          <p>Test access using the three port mappings shown.</p>
        </div>
      </section>

      <section id="pushing">
        <h2>2 ¬∑ Pushing an application</h2>
        <p>After building, you may share images by pushing them to DockerHub (or another registry).</p>

        <h3>2.1 ¬∑ Create an account</h3>
        <p>
          Create a DockerHub account on 
          <a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">
            DockerHub
          </a>.
        </p>


        <h3>2.2 ¬∑ Renaming the images</h3>
        <p>Tag images with the pattern <code>yourusername/image-name:image-tag</code>:</p>
        <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>docker tag pet-store-web YOUR-USERNAME/pet-store-web:1.0
docker tag pet-store-db  YOUR-USERNAME/pet-store-db:1.0</code></pre></div>

        <h3>2.3 ¬∑ Logging in</h3>
        <p>Login to DockerHub (Docker Desktop or CLI as applicable). The command for a Linux Machine follows as:</p>
        <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>docker login -u YOUR-USERNAME</code></pre></div>

        <h3>2.4 ¬∑ Pushing the images</h3>
        <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>docker push YOUR-USERNAME/pet-store-web:1.0
docker push YOUR-USERNAME/pet-store-db:1.0</code></pre></div>
                <p>
          Verify the images appear in your
          <a href="https://hub.docker.com/repositories" target="_blank" rel="noopener noreferrer">
            DockerHub registry
          </a>
        </p>

        <div class="infobox good">
          <strong>Good to know.</strong> You can streamline tagging and pushing via Compose:
          <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>services:
  web:
    build: web
    image: YOUR-USERNAME/pet-store-web:1.0
  db:
    build: database
    image: YOUR-USERNAME/pet-store-db:1.0</code></pre></div>
          <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>docker-compose build
docker-compose push</code></pre></div>
        </div>
      </section>

      <section id="kubernetes">
        <h2>3 ¬∑ Introduction to Kubernetes</h2>
        <p>Kubernetes orchestrates multi-service applications across a cluster.</p>
        <p>With Compose a <em>service</em> maps to an image; with Kubernetes we reason in terms of <strong>Pods</strong> (one or more containers together). In practice, we rarely manipulate Pods directly; higher-level controllers manage them.</p>

        <h3>3.1 ¬∑ Activate Kubernetes</h3>
        <h4>Docker Desktop (macOS/Windows)</h4>
        <p>Enable Kubernetes in Docker Desktop, then verify:</p>
        <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>kubectl get nodes</code></pre></div>
        <p>You should see node <code>docker-desktop</code> with status <em>READY</em>. If not, wait and retry.</p>
        <div class="infobox warn"><strong>Warning.</strong> If it doesn‚Äôt work, disable Kubernetes in Docker Desktop and use Minikube.</div>

        <h4>Linux (first install Minikube and then)</h4>
        <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>minikube start
kubectl get nodes
minikube tunnel</code></pre></div>
        <p><strong>Note (Tunnel).</strong> <code>minikube tunnel</code> creates routing for <code>LoadBalancer</code> services.</p>

        <h3>3.2 ¬∑ Deploying a pod</h3>
        <p>Pod spec:</p>
        <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>apiVersion: v1
kind: Pod
metadata:
  name: web-pod
  labels:
    app: web-pod
spec:
  containers:
  - name: web
    image: nginx:alpine
    ports:
    - containerPort: 80</code></pre></div>
        <p><strong>apiVersion</strong>, <strong>kind</strong>, <strong>metadata</strong> and <strong>spec</strong> describe the object.</p>

        <div class="card">
          <h4>Activity</h4>
          <ol>
            <li>Save as <code>sample-pod.yaml</code>.</li>
            <li><code>kubectl create -f sample-pod.yaml</code></li>
            <li><code>kubectl get pods</code> until status is <em>Running</em>.</li>
            <li><code>kubectl get pod -o wide web-pod</code> for details.</li>
          </ol>
        </div>

        <div class="exercise">
          <h3>Exercise 3.1</h3>
          <ol>
            <li>What happens at <code>http://localhost:80</code>? What about the Pod IP?</li>
            <li>What object do we need to expose the Pod?</li>
          </ol>
        </div>

        <p>Define a <strong>Service</strong> of type <code>LoadBalancer</code>:</p>
        <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  type: LoadBalancer
  ports:
  - port: 8080
    targetPort: 80
    protocol: TCP
    name: http
  selector:
    app: web-pod</code></pre></div>

        <div class="infobox good">
          <strong>Good to know.</strong> A LoadBalancer service exposes an external IP (often implemented on top of a NodePort).
        </div>

        <div class="exercise">
          <h3>Exercise 3.2</h3>
          <p>What is the <code>selector</code> field used for?</p>
        </div>

        <div class="exercise">
          <h3>Exercise 3.3</h3>
          <p>Explain <code>port</code> vs <code>targetPort</code> in the Service spec.</p>
        </div>

        <div class="card">
          <h4>Activity</h4>
          <ol>
            <li>Save as <code>sample-service.yaml</code>.</li>
            <li><code>kubectl create -f sample-service.yaml</code></li>
            <li><code>kubectl get services</code> or <code>kubectl get svc/nginx-service</code></li>
          </ol>
        </div>

        <div class="exercise">
          <h3>Exercise 3.4</h3>
          <p>From <code>kubectl get svc/nginx-service</code>, which URL opens the service?</p>
        </div>

        <div class="infobox bad">
          <strong>Cleanup.</strong>
          <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>kubectl delete po/web-pod
kubectl delete svc/nginx-service</code></pre></div>
        </div>
      </section>

      <section id="k8s-app">
        <h2>4 ¬∑ Kubernetes: deploying the Pet Store</h2>
        <p>We will deploy two services: <code>web</code> and <code>db</code>. For each one we need a workload resource and a Service object. Prefer controllers over bare Pods.</p>

        <div class="exercise">
          <h3>Exercise 4.1</h3>
          <ol>
            <li>Is <code>web</code> stateless or stateful?</li>
            <li>Is <code>db</code> stateless or stateful?</li>
          </ol>
        </div>

        <h3>4.1 ¬∑ Web service: Deployment</h3>
        <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: web
spec:
  replicas: 3
  selector:
    matchLabels:
      app: pets
      service: web
  template:
    metadata:
      labels:
        app: pets
        service: web
    spec:
      containers:
      - image: YOUR-USERNAME/pet-store-web:1.0
        name: web
        ports:
        - containerPort: 3000
          protocol: TCP</code></pre></div>

        <div class="card">
          <h4>Activity</h4>
          <ol>
            <li>Save as <code>web-deployment.yaml</code> (replace image with yours).</li>
            <li><code>kubectl create -f web-deployment.yaml</code></li>
          </ol>
        </div>

        <div class="exercise">
          <h3>Exercise 4.2</h3>
          <p>After <code>kubectl get all</code>, which objects were created?</p>
        </div>

        <div class="exercise">
          <h3>Exercise 4.3</h3>
          <ol>
            <li>Delete a Pod from this Deployment. What happens?</li>
            <li>Re-run <code>kubectl get all</code>: how many Pods now? Why?</li>
          </ol>
        </div>

        <h3>4.2 ¬∑ Web service: Service</h3>
        <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>apiVersion: v1
kind: Service
metadata:
  name: web
spec:
  type: LoadBalancer
  ports:
  - port: 8080
    targetPort: 3000
    protocol: TCP
  selector:
    app: pets
    service: web</code></pre></div>

        <div class="card">
          <h4>Activity</h4>
          <ol>
            <li>Save as <code>web-service.yaml</code>.</li>
            <li><code>kubectl create -f web-service.yaml</code></li>
            <li><code>kubectl get services</code> and browse <code>http://EXTERNAL-IP:8080</code>.</li>
          </ol>
        </div>

        <h3>4.3 ¬∑ DB service: StatefulSet</h3>
        <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: db
spec:
  selector:
    matchLabels:
      app: pets
      service: db
  serviceName: db
  template:
    metadata:
      labels:
        app: pets
        service: db
    spec:
      containers:
      - image: YOUR-USERNAME/pet-store-db:1.0
        name: db
        ports:
        - containerPort: 5432
        volumeMounts:
        - mountPath: /var/lib/postgresql/data
          name: pets-data
  volumeClaimTemplates:
  - metadata:
      name: pets-data
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 100Mi</code></pre></div>

        <div class="card">
          <h4>Activity</h4>
          <ol>
            <li>Save as <code>db-stateful-set.yaml</code> (replace image with yours).</li>
            <li><code>kubectl create -f db-stateful-set.yaml</code></li>
          </ol>
        </div>

        <div class="exercise">
          <h3>Exercise 4.5</h3>
          <p>Which objects are created by the StatefulSet?</p>
        </div>

        <div class="exercise">
          <h3>Exercise 4.6</h3>
          <p>Open the web page (Docker Desktop or Minikube). Then run <code>kubectl get all</code>. What do you observe and why?</p>
          <p>Check previous Pod logs:</p>
          <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>kubectl logs NAME-OF-POD --previous</code></pre></div>
        </div>

        <div class="exercise">
          <h3>Exercise 4.7</h3>
          <p>Do the logs confirm your explanation?</p>
        </div>
      </section>

      <section id="db-service">
        <h2>5 ¬∑ The DB service: Service object</h2>
        <div class="exercise">
          <h3>Exercise 5.1</h3>
          <p>Should the DB be accessible to clients outside the cluster?</p>
        </div>
        <div class="exercise">
          <h3>Exercise 5.2</h3>
          <p>Given your answer, which <code>Service</code> type should be used?</p>
        </div>
        <div class="exercise">
          <h3>Exercise 5.3</h3>
          <p>Write <code>db-service.yaml</code> (hint: mind <code>spec.serviceName</code> in the StatefulSet).</p>
          <div class="card">
            <h4>Activity</h4>
            <ol>
              <li><code>kubectl create -f db-service.yaml</code></li>
              <li><code>kubectl get all</code></li>
              <li>Access <code>http://localhost:8080/pet</code> (Minikube: use external IP of web Service). If DB isn‚Äôt ready, wait and retry.</li>
            </ol>
          </div>
        </div>

        <h3>5.1 ¬∑ Shutting down</h3>
        <div class="pre-wrap"><button class="copy-btn">Copy</button><pre><code>kubectl delete svc/web
kubectl delete svc/db
kubectl delete deploy/web
kubectl delete statefulset/db</code></pre></div>
        <p>Run <code>kubectl get all</code> multiple times to see resources disappear.</p>
        <p>Now, you are ready to our final tutorial (TripMeal)!</p>

      <div class="pager">
        <a href="ia382_running_containers.html" aria-label="Previous tutorial">
          <div><small>‚Üê Previous</small><div>02 ¬∑ Running Containers</div></div>
        </a>
        <a href="ia382_tripmeal.html" aria-label="Next tutorial">
          <div><small>Next ‚Üí</small><div>04 ¬∑ Lab: TripMeal</div></div>
        </a>
      </div>
    </main>
  </div>

  <footer>
    <p>¬© <span id="year"></span> FEEC/UNICAMP ¬∑ IA382 Practical Tutorials ¬∑ Developed by: AI and Fernando Santiago</p>
  </footer>

  <script>
    // Theme init/toggle
    (function initTheme(){
      const root=document.documentElement;
      const saved=localStorage.getItem('theme');
      if(saved==='light' || saved==='dark'){ root.setAttribute('data-theme', saved); }
      else { const prefersLight=window.matchMedia('(prefers-color-scheme: light)').matches; root.setAttribute('data-theme', prefersLight ? 'light' : 'dark'); }
      const btn=document.getElementById('theme-toggle');
      const isLight = root.getAttribute('data-theme')==='light';
      btn.textContent = isLight ? 'üåô Dark' : '‚òÄÔ∏è Light';
    })();
    document.getElementById('theme-toggle').addEventListener('click', () => {
      const root=document.documentElement;
      const current=root.getAttribute('data-theme');
      const next=current==='light'?'dark':'light';
      root.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      document.getElementById('theme-toggle').textContent = next==='light' ? 'üåô Dark' : '‚òÄÔ∏è Light';
    });
    
    // Year (targets span in added footer)
    document.getElementById('year').textContent = new Date().getFullYear();

    // Copy buttons (Adapted for this file's structure + visual feedback)
    document.addEventListener('click', async ev => {
      const btn = ev.target.closest('.copy-btn'); if(!btn) return;
      // This selector logic is specific to this file's HTML
      const pre = btn.nextElementSibling; const code = pre.querySelector('code'); if(!code) return; 
      try{ 
        await navigator.clipboard.writeText(code.innerText); 
        const old=btn.textContent; 
        btn.textContent='Copied!'; 
        btn.classList.add('copied'); // Added class
        setTimeout(()=>{
          btn.textContent=old;
          btn.classList.remove('copied'); // Remove class
        },1200);
      }catch(e){console.error(e);}
    });

    // ====== TOC generator + Scroll Spy (Replaced with robust version) ======
// ====== TOC generator + Scroll Spy (COM SCROLL AUTOM√ÅTICO) ======
    (function makeTOC(){
      const toc = document.getElementById('toc-list');
      const content = document.getElementById('content');
      if(!toc || !content) return;
      function slug(s){ return s.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }
      const headings = content.querySelectorAll('h2, h3');
      const links = [];
      
      headings.forEach(h => {
        if(!h.id){ h.id = slug(h.textContent); }
        const a = document.createElement('a');
        a.href = '#'+h.id;
        // L√≥gica para indentar H3 (se existir)
        a.textContent = h.tagName === 'H2' ? h.textContent : '‚Äî ' + h.textContent;
        a.dataset.target = h.id;
        toc.appendChild(a);
        links.push(a);
      });
      
      const map = new Map(links.map(a => [a.dataset.target, a]));
      const obs = new IntersectionObserver(entries => {
        let lastActive = null; 
        entries.forEach(e => {
          const id = e.target.id;
          const link = map.get(id);
          if(!link) return;
          if(e.isIntersecting){
            link.classList.add('active');
            lastActive = link;
          } else {
            link.classList.remove('active');
          }
        });
        
        if(lastActive) {
          links.forEach(l => l.classList.remove('active'));
          lastActive.classList.add('active');
          
          // --- ADI√á√ÉO PRINCIPAL ---
          // Isto faz o scroll autom√°tico do TOC para manter o link ativo vis√≠vel
          lastActive.scrollIntoView({
            behavior: 'smooth', // Rolagem suave
            block: 'nearest',   // Rola o m√≠nimo poss√≠vel para o item aparecer
            inline: 'nearest'
          });
          // --- FIM DA ADI√á√ÉO ---
        }
      }, { rootMargin: '0px 0px -70% 0px', threshold: 0.1 });
      headings.forEach(h => obs.observe(h));
    })();
    
    // ====== Scroll Progress Bar (Added) ======
    (function setupProgressBar() {
      // Inject the bar element via JS
      const bar = document.createElement('div');
      bar.className = 'progress-bar';
      const nav = document.querySelector('.navbar');
      if(nav) nav.appendChild(bar);
      
      window.addEventListener('scroll', () => {
        const max = document.documentElement.scrollHeight - window.innerHeight;
        const percent = (window.scrollY / max) * 100;
        bar.style.width = percent + '%';
      }, { passive: true });
    })();
    
    // ====== Scroll Animations (Added) ======
    (function scrollAnimate() {
      // Targets for this specific file
      const targets = document.querySelectorAll('.card, .infobox, .exercise, .pager a, section > ul, section > p, section > ol');
      if (!('IntersectionObserver' in window)) return; // Fail gracefully
      
      const obs = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('in-view');
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
      
      targets.forEach(t => {
        t.classList.add('animate-on-scroll');
        obs.observe(t);
      });
    })();
  </script>
</body>
</html>
